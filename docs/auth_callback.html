<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GitHub OAuth Callback</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans px-6 py-10">
  <div class="max-w-xl mx-auto text-center">
    <h1 class="text-3xl font-bold mb-4">üîê GitHub OAuth</h1>
    <p class="text-gray-300 mb-6">Processing your authentication...</p>
    <p id="status" class="text-yellow-400 text-sm">‚è≥ Exchanging code for access token...</p>
  </div>

  <script>
    const code = new URLSearchParams(window.location.search).get("code");
    const clientId = localStorage.getItem("clientID");
    const clientSecret = prompt("üîê Paste your GitHub Client Secret (only you see this):");

    async function exchangeCodeForToken() {
      if (!code || !clientId || !clientSecret) {
        document.getElementById("status").innerText = "‚ùå Missing required data for token exchange.";
        return;
      }

      try {
        const res = await fetch("https://github.com/login/oauth/access_token", {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            client_id: clientId,
            client_secret: clientSecret,
            code: code
          })
        });

        const data = await res.json();
        if (data.access_token) {
          localStorage.setItem("githubToken", data.access_token);
          document.getElementById("status").innerText = "‚úÖ GitHub Access Token Acquired!";
          setTimeout(() => {
            window.location.href = "index.html";
          }, 1500);
        } else {
          document.getElementById("status").innerText = `‚ùå Token exchange failed: ${data.error_description || data.error}`;
        }
      } catch (e) {
        document.getElementById("status").innerText = "‚ùå Network error while exchanging token.";
      }
    }

    exchangeCodeForToken();
  </script>
</body>
</html>
