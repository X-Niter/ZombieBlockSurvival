<!DOCTYPE html>
<html lang="en">
<head>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  body {
    margin: 0;
    font-family: 'Press Start 2P', monospace;
    background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.9)),
                url('assets/bg_clean.jpg') center/cover no-repeat fixed;
    color: #f8f8f2;
  }

  .hud-nav {
    display: flex;
    justify-content: center;
    background: rgba(0, 0, 0, 0.85);
    padding: 1rem;
    border-bottom: 2px solid #39ff14;
  }

  .hud-nav a {
    color: #39ff14;
    text-decoration: none;
    margin: 0 1.5rem;
    font-weight: bold;
    transition: color 0.2s;
  }

  .hud-nav a:hover {
    color: #00bfff;
  }

  .glass-panel {
    background: rgba(0,0,0,0.65);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 2rem;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    margin: 2rem auto;
    max-width: 900px;
    box-shadow: 0 0 24px rgba(0,255,128,0.2);
  }

  .button {
    background: #ffaa00;
    border: none;
    padding: 0.6rem 1.2rem;
    color: black;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
    box-shadow: 0 0 6px rgba(255,255,255,0.2);
  }

  .status-box {
    background: #202020;
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
    color: #00ffcc;
  }

  h1 {
    color: #ff4444;
    font-size: 1.5rem;
    text-align: center;
  }
</style>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZombieBlockSurvival Control Hub</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  
</head>
<body class="font-mono">
  <header class="w-full text-center py-6 bg-black bg-opacity-80 shadow-md">

<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  body {
    margin: 0;
    font-family: 'Press Start 2P', monospace;
    background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.9)),
                url('assets/bg_clean.jpg') center/cover no-repeat fixed;
    color: #f8f8f2;
  }

  .hud-nav {
    display: flex;
    justify-content: center;
    background: rgba(0, 0, 0, 0.85);
    padding: 1rem;
    border-bottom: 2px solid #39ff14;
  }

  .hud-nav a {
    color: #39ff14;
    text-decoration: none;
    margin: 0 1.5rem;
    font-weight: bold;
    transition: color 0.2s;
  }

  .hud-nav a:hover {
    color: #00bfff;
  }

  .glass-panel {
    background: rgba(0,0,0,0.65);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 2rem;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    margin: 2rem auto;
    max-width: 900px;
    box-shadow: 0 0 24px rgba(0,255,128,0.2);
  }

  .button {
    background: #ffaa00;
    border: none;
    padding: 0.6rem 1.2rem;
    color: black;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
    box-shadow: 0 0 6px rgba(255,255,255,0.2);
  }

  .status-box {
    background: #202020;
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
    color: #00ffcc;
  }

  h1 {
    color: #ff4444;
    font-size: 1.5rem;
    text-align: center;
  }
</style>

    <h1 class="text-4xl font-bold tracking-widest text-red-500">üßü ZombieBlockSurvival</h1>
    <p class="text-sm text-gray-300">7 Days to Die-Inspired Minecraft Control Panel</p>
  </header>

  <nav class="flex justify-center space-x-4 py-4 bg-black bg-opacity-60">
    <a href="index.html" class="hover:underline">Dashboard</a>
    <a href="diagnostics.html" class="hover:underline">Diagnostics</a>
    <a href="ai_interact.html" class="hover:underline">AI Console</a>
    <a href="#" onclick="toggleModal('authModal')" class="hover:underline text-yellow-300">Auth Setup</a>
    <a href="changelogs.html" class="hover:underline text-green-400">Changelogs</a>
    <a href="https://github.com/X-Niter/ZombieBlockSurvival" target="_blank" class="hover:underline text-blue-400">GitHub</a>
    <a href="combined_changelog.html" class="hover:underline text-indigo-400">Combined Changelog</a>
</nav>

  <main class="p-6 flex flex-col items-center space-y-6 glass max-w-3xl mx-auto mt-6 rounded-xl shadow-xl">
    <h2 class="text-2xl font-bold text-red-400">Welcome, Survivor</h2>
    <p class="text-sm text-gray-300">This dashboard is your command center. Configure tokens, run AI tools, and survive the plugin apocalypse.</p>

    <button onclick="toggleModal('authModal')" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">üîê Configure Tokens</button>
  
<section class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
  <div class="bg-gray-800 p-4 rounded shadow-lg">
    <h3 class="text-lg font-bold mb-2">üß† AI Status</h3>
    <p id="aiStatus" class="text-sm text-gray-300">Checking...</p>
  </div>
  <div class="bg-gray-800 p-4 rounded shadow-lg">
    <h3 class="text-lg font-bold mb-2">üîó GitHub Status</h3>
    <p id="ghStatus" class="text-sm text-gray-300">Checking...</p>
  </div>
  <div class="bg-gray-800 p-4 rounded shadow-lg sm:col-span-2">
    <h3 class="text-lg font-bold mb-2">üìã Recent Activity</h3>
    <ul id="activityLog" class="list-disc list-inside text-sm text-gray-300 space-y-1">
      <li>Fetching latest commits...</li>
    </ul>
  </div>

<div class="bg-gray-800 p-4 rounded shadow-lg sm:col-span-2 mt-4">
  <h3 class="text-lg font-bold mb-2">üß† Custom Prompt</h3>
  <textarea id="aiPromptInput" rows="3" class="w-full p-2 text-sm rounded bg-gray-700 text-white mb-2" placeholder="Describe a fix, request a refactor, or ask for a change..."></textarea>
  <button onclick="sendPrompt()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-1 rounded text-sm">‚ñ∂Ô∏è Send Prompt</button>
</div>

<div class="bg-gray-800 p-4 rounded shadow-lg sm:col-span-2 mt-4">
  <h3 class="text-lg font-bold mb-2">üõ† GitHub Command</h3>
  <input type="text" id="ghCommandInput" class="w-full p-2 text-sm rounded bg-gray-700 text-white mb-2" placeholder="e.g., list recent PRs">
  <button onclick="runGHCommand()" class="bg-blue-600 hover:bg-blue-700 px-4 py-1 rounded text-sm">‚ñ∂Ô∏è Run GitHub Cmd</button>
</div>

<script>
  async function sendPrompt() {
    const prompt = document.getElementById("aiPromptInput").value.trim();
    const openaiKey = localStorage.getItem("openaiKey");

    if (!prompt) return alert("Enter a prompt first.");
    if (!openaiKey) return alert("Missing OpenAI key.");

    logFeed("üì® Prompt sent: " + prompt);

    try {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${openaiKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 100
        })
      });
      const json = await res.json();
      const reply = json.choices?.[0]?.message?.content || "‚ö†Ô∏è No reply.";
      logFeed("üß† GPT: " + reply.substring(0, 120).trim() + (reply.length > 120 ? "..." : ""));
    } catch {
      logFeed("‚ùå Prompt failed: OpenAI error.");
    }
  }

  async function runGHCommand() {
    const command = document.getElementById("ghCommandInput").value.trim();
    const githubToken = localStorage.getItem("githubToken");

    if (!command) return alert("Type a command to run.");
    if (!githubToken) return alert("Missing GitHub token.");

    logFeed("üõ† GitHub Cmd: " + command);

    if (command === "list recent PRs") {
      try {
        const res = await fetch("https://api.github.com/repos/X-Niter/ZombieBlockSurvival/pulls", {
          headers: { Authorization: `token ${githubToken}` }
        });
        const data = await res.json();
        if (Array.isArray(data)) {
          data.slice(0, 3).forEach(pr => {
            logFeed(`üîÉ PR #${pr.number}: ${pr.title}`);
          });
        } else {
          logFeed("‚ö†Ô∏è Could not fetch PRs.");
        }
      } catch {
        logFeed("‚ùå GitHub fetch failed.");
      }
    } else {
      logFeed("‚ö†Ô∏è Unknown command.");
    }
  }
</script>


<div class="bg-gray-800 p-4 rounded shadow-lg sm:col-span-2 mt-4">
  <h3 class="text-lg font-bold mb-2">üìö Prompt History</h3>
  <ul id="promptHistory" class="list-disc list-inside text-sm text-gray-300 space-y-1">
    <li>No history yet.</li>
  </ul>
</div>

<script>
  function saveToHistory(prompt, reply) {
    let history = JSON.parse(localStorage.getItem("promptHistory") || "[]");
    history.unshift({ prompt, reply, time: new Date().toISOString() });
    localStorage.setItem("promptHistory", JSON.stringify(history.slice(0, 20)));  // keep only last 20
    renderHistory();
  }

  function renderHistory() {
    const hist = JSON.parse(localStorage.getItem("promptHistory") || "[]");
    const container = document.getElementById("promptHistory");
    container.innerHTML = "";
    if (!hist.length) {
      container.innerHTML = "<li>No history yet.</li>";
      return;
    }
    hist.forEach(entry => {
      const li = document.createElement("li");
      li.innerText = `[${new Date(entry.time).toLocaleTimeString()}] üß† ${entry.prompt.slice(0, 40)} ‚Üí ${entry.reply.slice(0, 40)}...`;
      container.appendChild(li);
    });
  }

  // Patch into prompt submission
  async function sendPrompt() {
    const prompt = document.getElementById("aiPromptInput").value.trim();
    const openaiKey = localStorage.getItem("openaiKey");

    if (!prompt) return alert("Enter a prompt first.");
    if (!openaiKey) return alert("Missing OpenAI key.");

    logFeed("üì® Prompt sent: " + prompt);

    try {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${openaiKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 100
        })
      });
      const json = await res.json();
      const reply = json.choices?.[0]?.message?.content || "‚ö†Ô∏è No reply.";
      logFeed("üß† GPT: " + reply.substring(0, 120).trim() + (reply.length > 120 ? "..." : ""));
      saveToHistory(prompt, reply);
    } catch {
      logFeed("‚ùå Prompt failed: OpenAI error.");
    }
  }

  // Initial render
  renderHistory();
</script>

</section>
<div class="bg-gray-800 p-4 rounded shadow-lg sm:col-span-2 mt-4">
  <h3 class="text-lg font-bold mb-2">üßæ Activity Feed</h3>
  <ul id="activityFeed" class="list-disc list-inside text-sm text-gray-300 space-y-1">
    <li>Listening for events...</li>
  </ul>
</div>

<script>
  function logFeed(message) {
    const feed = document.getElementById("activityFeed");
    const li = document.createElement("li");
    li.innerText = `[${new Date().toLocaleTimeString()}] ${message}`;
    feed.appendChild(li);
  }

  // Append onto previous checkSystems logic
  async function checkSystems() {
    const openaiKey = localStorage.getItem("openaiKey");
    const githubToken = localStorage.getItem("githubToken");

    try {
      const aiRes = await fetch("https://api.openai.com/v1/models", {
        headers: { Authorization: `Bearer ${openaiKey}` }
      });
      if (aiRes.ok) {
        document.getElementById("aiStatus").innerText = "‚úÖ Connected to OpenAI";
        logFeed("üß† OpenAI models loaded successfully.");
      } else {
        document.getElementById("aiStatus").innerText = "‚ùå OpenAI Error";
        logFeed("‚ùå Failed to access OpenAI models.");
      }
    } catch {
      document.getElementById("aiStatus").innerText = "‚ùå OpenAI Unreachable";
      logFeed("‚ùå OpenAI unreachable (network error).");
    }

    try {
      const ghRes = await fetch("https://api.github.com/user/repos", {
        headers: { Authorization: `token ${githubToken}` }
      });
      const data = await ghRes.json();
      if (ghRes.ok) {
        document.getElementById("ghStatus").innerText = `‚úÖ GitHub Access Granted`;
        logFeed("üîó GitHub user repo list fetched.");
        const log = document.getElementById("activityLog");
        log.innerHTML = "";
        (data.slice(0, 5) || []).forEach(repo => {
          const li = document.createElement("li");
          li.innerText = `üìÅ ${repo.full_name}`;
          log.appendChild(li);
        });
      } else {
        document.getElementById("ghStatus").innerText = `‚ùå GitHub Error`;
        logFeed("‚ùå GitHub token error during repo fetch.");
      }
    } catch {
      document.getElementById("ghStatus").innerText = "‚ùå GitHub Unreachable";
      logFeed("‚ùå GitHub unreachable (network error).");
    }
  }

  // Run once on load
  checkSystems();
</script>


<script>
  async function checkSystems() {
    const openaiKey = localStorage.getItem("openaiKey");
    const githubToken = localStorage.getItem("githubToken");

    try {
      const aiRes = await fetch("https://api.openai.com/v1/models", {
        headers: { Authorization: `Bearer ${openaiKey}` }
      });
      document.getElementById("aiStatus").innerText = aiRes.ok ? "‚úÖ Connected to OpenAI" : "‚ùå OpenAI Error";
    } catch {
      document.getElementById("aiStatus").innerText = "‚ùå OpenAI Unreachable";
    }

    try {
      const ghRes = await fetch("https://api.github.com/user/repos", {
        headers: { Authorization: `token ${githubToken}` }
      });
      const data = await ghRes.json();
      document.getElementById("ghStatus").innerText = ghRes.ok ? `‚úÖ GitHub Access Granted` : `‚ùå GitHub Error`;

      const log = document.getElementById("activityLog");
      log.innerHTML = "";
      (data.slice(0, 5) || []).forEach(repo => {
        const li = document.createElement("li");
        li.innerText = `üìÅ ${repo.full_name}`;
        log.appendChild(li);
      });
    } catch {
      document.getElementById("ghStatus").innerText = "‚ùå GitHub Unreachable";
    }
  }

  checkSystems();
</script>

</main>

  <!-- Auth Modal -->
  <div id="authModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">
    <div class="modal rounded p-6 text-white relative shadow-xl">
      <button onclick="toggleModal('authModal')" class="absolute top-2 right-3 text-gray-400 hover:text-red-500">‚úñ</button>
      <h3 class="text-xl font-bold mb-4">üîê Token Configuration</h3>
      <label class="block mb-1 text-sm">GitHub Client ID</label>
      <input type="text" id="clientID" class="w-full mb-3 px-2 py-1 rounded bg-gray-700 text-white" placeholder="Ov23...">
      <label class="block mb-1 text-sm">GitHub Token (PAT)</label>
      <input type="password" id="githubToken" class="w-full mb-3 px-2 py-1 rounded bg-gray-700 text-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <label class="block mb-1 text-sm">OpenAI API Key</label>
      <input type="password" id="openaiKey" class="w-full mb-4 px-2 py-1 rounded bg-gray-700 text-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button onclick="saveTokens()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">üíæ Save</button>
    </div>
  </div>

  <script>
    function toggleModal(id) {
      const modal = document.getElementById(id);
      modal.classList.toggle('hidden');
      modal.classList.toggle('flex');
    }

    function saveTokens() {
      localStorage.setItem("clientID", document.getElementById("clientID").value.trim());
      localStorage.setItem("githubToken", document.getElementById("githubToken").value.trim());
      localStorage.setItem("openaiKey", document.getElementById("openaiKey").value.trim());
      alert("‚úÖ Tokens saved to browser memory.");
      toggleModal('authModal');
    }
  </script>
</body>
</html>
